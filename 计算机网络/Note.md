# 前言
- [全彩版OneNote链接](https://onedrive.live.com/view.aspx?resid=13E88115C35FE227%21832&id=documents
onenote:https://d.docs.live.net/13e88115c35fe227/文档/睿韬%20的笔记本/)

# 第2章 物理层

## 2.2 数据通信的基础知识

### 2.2.2 有关信道的几个基本概念

#### 常用编码方式

![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_a78cb6085b99f6801b292d10fb1e865e.png)

- 曼彻斯特编码
  - 位周期中心的向上跳变代表 0，位周期中心的向下跳变代表 1。但也可反过来定义。
- 差分曼彻斯特编码
  - 在每一位的中心处始终都有跳变。位开始边界有跳变代表0，而位开始边界没有跳变代表1。
- 从信号波形中可以看出，曼彻斯特（（Manchester）编码产生的信号频率比不归零制高。从自同步能力来看，不归零制不能从信号波形本身中提取信号时钟频率（这叫做没有自同步能力），而曼彻斯特编码具有自同步能力。

#### 基本的带通调制方法

![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_0f9bb1875f4b850a09b11cad34aa7bb4.png)

- 调幅（AM） 即载波的振幅随基带数字信号而变化。例如，0或1分别对应于无载波或有载波输出。
- 调频（FM） 即载波的频率随基带数字信号而变化。例如，0或1分别对应于频率f或f。
- 调相（PM） 即载波的初始相位随基带数字信号而变化。例如，0或1分别对应于相位0度或180度。
- 为了达到更高的信息传输速率，必须采用技术上更为复杂的多元制的振幅相位混合调制方法。例如，正交振幅调制 QAM（Quadrature Amplitude Modulation）。
- 有了上述的一些基本概念之后，我们再讨论信道的极限容量。

### 2.2.3 信道的极限容量

- 几十年来，通信领域的学者一直在努力寻找提高数据传输速率的途径。这个问题很复杂，因为任何实际的信道都不是理想的，**都不可能以任意高的速率进行传送**。我们知道，数字通信的优点就是∶虽然信号在信道上传输时会不可避免地产生失真，但在接收端只要我们从失真的波形中能够识别出原来的信号，那么这种失真对通信质量就没有影响。例如：

  - 图24（a）表示信号通过实际的信道传输后虽然有失真，但在接收端还可识别并恢复出原来的码元。
  - 但图2-4（b）就不同了，这时信号的失真已很严重，在接收端无法识别码元是1还是0。

- 码元传输的速率越高，或信号传输的距离越远，或噪声干扰越大，或传输媒体质量越差，在接收端的波形的失真就越严重。

- ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_d165206054bc8d855a68c383a6b1c767.png)

- 从概念上讲，限制码元在信道上的传输速率的因素有以下两个：

  1. 信道能够通过的频率范围

     - 具体的信道所能通过的频率范围总是有限的。信号中的许多高频分量往往不能通过信道。像图2-4所示的发送信号是一种典型的矩形脉冲信号，它包含很丰富的高频分量。如果信号中的高频分量在传输时受到衰减，那么在接收端收到的波形前沿和后沿就变得不那么陡峭了，每一个码元所占的时间界限也不再是很明确的，而是前后都拖了"尾巴"。这样，在接收端收到的信号波形就失去了码元之间的清晰界限。这种现象叫做码间串扰。严重的码间串扰使得本来分得很清楚的一串码元变得模糊而无法识别。早在1924年，奈奎斯特（Nyquist 就推导出了著名的奈氏准则。他给出了在假定的理想条件下，为了避免码间串扰，码元的传输速率的上限值。奈氏准则的推导已超出本书的范围，这可在通信原理教科书中查阅到。我们需要知道的就是∶在任何信道中，码元传输的速率是有上限的，传输速率超过此上限，就会出现严重的码间串扰的问题，使接收端对码元的判决（即识别）成为不可能。
     - 如果信道的频带越宽，也就是能够通过的信号高频分量越多，那么就可以用更高的速率传送码元而不出现码间串扰。

  2. 信噪比

     - 噪声存在于所有的电子设备和通信信道中。由于噪声是随机产生的，它的瞬时值有时会很大，因此噪声会使接收端对码元的判决产生错误（1误判为0或0误判为1）。但噪声的影响是相对的。如果信号相对较强，那么噪声的影响就相对较小。因此，信噪比就很重要。所谓信噪比就是信号的平均功率和噪声的平均功率之比，常记为 SN，并用分贝（dB）作为度量单位。即∶

     - ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_80782f993c8164e7ff8dea5024b2b630.png)

     - 例如，当S/N=10时，信噪比为10 dB，而当S/N=1000时，信噪比为30 dB。在1948年，信息论的创始人香农（Shannon）推导出了著名的**香农公式**。香农公式指出∶**信道的极限信息传输速率C**是：

     - ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_2c48cc18c9b16247b96074f18552d0ed.png)

     - 式中：

       - W为信道的带宽（以Hz为单位）;
       - S为信道内所传信号的平均功率;
       - N为信道内部的高斯噪声功率。

     - 香农公式的推导可在通信原理教科书中找到。这里只给出其结果。

     - 香农公式表明，**信道的带宽或信道中的信噪比越大，信息的极限传输速率就越高**。香农公式指出了信息传输速率的上限。香农公式的意义在于∶只要信息传输速率低于信道的极限信息传输速率，就一定存在某种办法来实现无差错的传输。不过，香农没有告诉我们具体的实现方法。这要由研究通信的专家去寻找。

     - 从以上所讲的不难看出，对于频带宽度已确定的信道，如果信噪比也不能再提高了，并且码元传输速率也达到了上限值，那么还有什么办法提高信息的传输速率呢?这就是用编码的方法让每一个码元携带更多比特的信息量。我们可以用个简单的例子来说明这个问题。
       假定我们的基带信号是∶    101011000110111010...

       





## 2.4 信道复用技术

### 2.4.1 频分复用、时分复用和统计时分复用

### 2.4.2 波分复用

- **波分复用WDM（Wavelength Division Multiplexing）就是光的频分复用。**光纤技术的应用使得数据的传输速率空前提高。现在人们借用传统的载波电话的频分复用的概念，就能做到使用一根光纤来同时传输多个频率很接近的光载波信号。这样就使光纤的传输能力可成倍地提高。由于光载波的频率很高，因此习惯上用波长而不用频率来表示所使用的光载波。这样就得出了波分复用这一名词。最初，人们只能在一根光纤上复用两路光载波信号。这种复用方式称为波分复用 WDM。随着技术的发展，在一根光纤上复用的光载波信号的路数越来越多。现在已能做到在一根光纤上复用几十路或更多路数的光载波信号。于是就使用了密集波分复用 DWDM（Dense Wavelength Division Multiplexing）这一名词。例如，每一路的数据率是40 Gbit/s，使用DWDM后，如果在一根光纤上复用64路，就能够获得2.56 Tbit/s的数据率。图2-17给出了波分复用的概念。

### 2.4.3 码分复用

- **码分复用 CDM**（Code Division Multiplexing）是另一种共享信道的方法。实际上，人们更常用的名词是**码分多址CDMA**（Code Division Multiple Access)。每一个用户可以在同样的时间使用同样的频带进行通信。**由于各用户使用经过特殊挑选的不同码型，因此各用户之间不会造成干扰。**码分复用最初用于军事通信，因为这种系统发送的信号**有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。**随着技术的进步，CDMA设备的价格和体积都大幅度下降，因而现在已广泛使用在民用的移动通信中，特别是在无线局域网中。采用CDMA 可提高通信的话音质量和数据传输的可靠性，减少干扰对通信的影响，增大通信系统的容量（是使用GSM的4~5倍），降低手机的平均发射功率，等等。下面简述其工作原理。
- 在 CDMA 中，每一个比特时间再划分为m个短的间隔，称为**码片**（chip）。通常m的值是64或128。在下面的原理性说明中，为了画图简单起见，我们设m为8。
  使用CDMA的每一个站被指派一个唯一的m bit 码片序列（chip sequence）。一个站如果要发送比特1，则发送它自己的 m bit 码片序列。如果要发送比特0，则发送该码片序列的二进制反码。例如，指派给S站的8 bit码片序列是00011011。当S发送比特1时，它就发送序列00011011，而当S发送比特0时，就发送1100100。为了方便，我们按惯例将码片中的0写为-1，将1写为+1。因此S站的码片序列是（-1-1-1+1+1-1+1+1）。
- 现假定 S 站要发送信息的数据率为b bit/s。由于每一个比特要转换成 m 个比特的码片，因此S站实际上发送的数据率提高到 mb bit/s，同时S站所占用的频带宽度也提高到原来数值的 m倍。这种通信方式是扩频（spread spectrum）通信中的一种。扩频通信通常有两大类:
  - 一种是直接序列扩频 DSSS （Direct Sequence Spread Spectrum），如上面讲的使用码片序列就是这一类。
  - 另一种是跳频扩频 FHSS（Frequency Hopping Spread Spectrum）。
- CDMA 系统的一个重要特点就是这种体制给每一个站分配的码片序列不仅必须各不相同，并且还必须互相**正交**（orthogonal）。在实用的系统中是使用**伪随机码序列**。
  用数学公式可以很清楚地表示码片序列的这种正交关系。令向量S表示站S的码片向量，再令T表示其他任何站的码片向量。两个不同站的码片序列正交，就是向量S和T的规格化内积（inner product）都是0∶
- ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_dc5ad41971415a198e48ee99c6d903a1.png)





## 2.3 物理层下面的传输媒体

- **传输媒体**也称为传输介质或传输媒介，它就是数据传输系统中在发送器和接收器之间的物理通路。传输媒体可分为两大类，即**导引型传输媒体**和**非导引型传输媒体**（这里的"导引型"的英文就是guided，也可译为"导向传输媒体"）。在导引型传输媒体中，电磁波被导引沿着固体媒体（铜线或光纤）传播，而非导引型传输媒体就是指自由空间，在非导引型传输媒体中电磁波的传输常称为无线传输。图2-5是电信领域使用的电磁波的频谱。
- ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_ea13aa4fc592d859fba0427857559601.png)



### 2.3.1 导引型传输媒体

1. 双绞线
   - 双绞线也称为双扭线，是最古老但又是最常用的传输媒体。把两根互相绝缘的铜导线并排放在一起，然后用规则的方法绞合（（wist）起来就构成了双绞线。绞合可减少对相邻导线的电磁干扰。使用双绞线最多的地方就是到处都有的电话系统。几乎所有的电话都用双绞线连接到电话交换机。这段从用户电话机到交换机的双绞线称为**用户线**或**用户环路**（subscriber loop）。通常将一定数量的这种双绞线捆成电缆，在其外面包上护套。
   - 模拟传输和数字传输都可以使用双绞线，其通信距离一般为几到十几公里。距离太长时就要加放大器以便将衰减了的信号放大到合适的数值（对于模拟传输），或者加上中继器以便对失真了的数字信号进行整形（对于数字传输）。导线越粗，其通信距离就越远，但导线的价格也越高。在数字传输时，若传输速率为每秒几个兆比特，则传输距离可达几公里。由于双绞线的价格便宜且性能也不错，因此使用十分广泛。
   - 为了提高双绞线抗电磁干扰的能力，可以在双绞线的外面再加上一层用金属丝编织成的屏蔽层。这就是屏蔽双绞线，简称为STP（Shielded Twisted Pair）。它的价格当然比无屏蔽双绞线UTP（（Unshielded Twisted Pair）要贵一些。图2-6是无屏蔽双绞线和屏蔽双绞线的示意图。


# 3->第2章 数据通信接口与物理层
## 3.1 数据通信基础
## 3.2 物理层
### 学习目标
- 掌握物理层的基本概念
- 了解物理层的基本功能
- 熟悉物理层的基本设备

### 物理层接口、标准与设备
#### 学习内容
- 物理层的接口
- EIA RS-232-C标准
- 物理层相关的物理设备
#### 物理层接口
- 物理层的接口协议规定了建立、维持以及断开物理信道所需的机械、电气、功能和规程的特性，其作用是确保比特流能在物理传输介质上传输。
- 物理层就是通过这四个特性，在数据终端设备和数据通信设备之间，实现物理通路的连接。 
  - 数据终端设备(Data Terminal Equipment ，DTE，指数据通信的信源，如计算机)
  - 数据通信设备(Data Circuit-terminal Equipment ，DCE，指数据通信中面向用户的设备，如调制解调器)
##### 机械特性
- 机械特性规定了物理连接时插头和插座的几何尺寸、插针或插孔芯数及排列方式、锁定装置形式等。
- 下图列出了一类已被ISO标准化了的DCE连接器的几何尺寸、插孔芯数和排列方式，以及连接器实物图片。
- 一般DTE的连接器常用插针形式、几何尺寸与DCE连接器相配合，而插针芯数和排列方式与DCE连接器成镜像对称。
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_f9d84a0da7f473a31b255172b6ef0cc5.png)

##### 电气特性
- 电气特性规定了在物理连接上导线的电气连接及有关的电回路的特性，包括接收器和发送器电路特性的规定、表示信号状态的电压/电流电平的识别、最大传输速率的规定，以及与互连电缆相关的规则等。同时还规定了DTE/DCE接口线的信号电平、发送器的输出阻抗、接收器的输入阻抗等电气参数。
- 通常，DTE/DCE接口的各导线的电气连接方式有非平衡方式、采用差动接收器的非平衡方式和平衡方式三种。

##### 功能特性
- 功能特性规定了接口信号的来源、作用以及其他信号之间的关系。DTE/DCE标准接口的功能特性主要是对各接口信号线作出确切的功能定义，并确定相互间的操作关系。
- 例如，接口信号线按其功能一般可分为接地线、数据线、控制线、定时线等类型。

##### 规程特性
- 规程特性规定了使用交换电路进行数据交换的控制步骤，以使得比特流传输得以完成。DTE/DCE标准接口的规程特性规定了DTE/DCE接口各信号线之间的相互关系、动作顺序以及维护测试操作等内容。
- 物理层中较重要的新规程是EIA RS-449及X.21
  - 然而经典的EIA RS-232C仍是目前最常用的计算机异步通信接口。

#### EIA RS-232-C标准
- EIA RS-232-C是由美国电子工业协会EIA制定的串行通信物理接口标准。最初是远程数据通信时，为连接DTE和DCE而制定的。
- 它规定以25芯(DB-25)或9芯(DB-9)的D型插针连接器与外部相连，如图所示。
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_908a090fe0dfc81da56576f15b10960c.png)

#### 物理层相关的物理设备
##### 中继器
- 由于存在损耗，在物理线路上传输的信号功率会逐渐衰减，衰减到一定程度时将造成信号失真，因此会导致接收错误。中继器(Repeater)就是为解决这一问题而设计的。
- 中继器是局域网环境下用来延长网络距离的最简单最廉价的网络互联设备，常用于两个网络节点之间物理信号的双向转发工作，负责在两个节点的物理层上按位传递信息，完成信号的复制、调整和放大功能，使之保持与原数据相同，以此来延长网络的长度。 
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_5afa093d1943dca0201aae9a7b8a6691.png)

##### 集线器
- 集线器的(Hub)，是一种特殊的中继器，即多端口的中继器，其主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离。
- 集线器是一个纯硬件多端口的转发器，当以集线器为中心设备时，网络中某条线路产生了故障，并不影响其它线路的工作。
- 集线器在局域网中得到了广泛的应用，一度成为局域网组网的主要设备。
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_9f334130f2f537346ccb3c113915618e.png)

##### 调制解调器
- 调制解调器(Modem)，是一个将数字信号调制到模拟载波信号上进行传输，并解调收到的模拟信号以得到数字信号的设备。
- 其目标是产生能够方便传输的模拟信号并且能够通过解码还原原来的数字数据。根据不同的应用场合，调制解调器可以使用不同的手段来传送模拟信号，比如使用光纤，射频无线电或电话线等。 
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_cfd1ac43cd7a6074e2f921233b8d841c.png)

# 4->第3章 数据链路层与局域网
## 3.1 数据链路层概述
### 互联网是由不同类型的传输网络互联而成的网际网
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_87ebefc739610d30bc3490d7e3c96951.png)
> 在第一讲中，我们曾经讲过互联网是由不同类型的传输网络互联而成的网际网，那么这一讲我们要学习的以太网就是其中的一种传输网络。

### 信号传输模型
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_a859c667ebf9b2b845d86c7c3e94829c.png)
- 物理层主要解决比特流的传输，对传输的可靠性不作过多处理。如何保证传输的正确性？
> 数据链路层->信号直接可达的设备之间数据正确传输

### 如何保证数据传输的正确性？
- 如何检测、控制传输中造成的差错
  - 检错码
    - 奇偶校验
    - 循环冗余
    - 检验和
  - 纠错码
    - 海明码
    - 二维奇偶校验码
- 数据帧
  - 数据+校验码
  - ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_01ebe2ff6dd63f216ce99081883a8893.png)

- **组织成帧（数据包）:数据链路层以帧为单位组织传输数据**
- 数据链路层的主要功能
  - 封装成帧
  - 帧同步
  - 透明传输
  - 差错控制
  - 寻址
  - 链路管理
  - 流量控制
- 数据链路层的基本功能
  - 封装成帧
  - 透明传输
  - 差错控制 

### 学习目标
- 掌握数据链路层的基本概念
- 了解数据链路层的基本功能

### 数据链路层的简单模型
#### 本节学习内容
- 数据链路层基本概念
- 数据链路层简单模型

#### 数据链路层的简单模型
- 数据链路层于物理层之上,属于低层。物理层传输的是比特流，单位是比特。数据链路层传输单位是帧，一帧一帧地处理。其工作是从物理层获取比特流，进行封装成帧、并对帧进行一系列,如透明传输、差错控制等处理，从而递交给上一层（网络层），同时也对网络层下传的数据进行处理，进而传给物理层。
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_4d09b846d95d07ac7d472176016a047d.png)
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_7a5e7156a6986fc97f90cbe32d685ccc.png)
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_01311e4cb67a460cfde6e154a1cca2fc.png)
- 常常在两个对等的数据链路层之间画出一个数字管道，而在这条数字管道上传输的数据单位是帧。
  - ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_9b0a34f51e772433e947023546037451.png)
- 早期的数据通信协议曾叫作通信规程(procedure)。因此在数据链路层，规程和协议是同义语。 
- 点对点信道：使用一对一的点对点通信方式
  - ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_51e70b18a542a90800740bdb5494e288.png)
  - 信源发出的信息只有信宿能收到，其他节点收不到  
- 广播信道：使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送 。
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_e72880623fab9288d0faf2a1d6ada961.png)
- 不同的信道类型，封装成帧的方式不同，需要实现的功能也有所区别，但是共性的都需要封装成帧、差错校验和透明传输。

#### 数据链路层基本功能
##### 本节学习内容
- 封装成帧
- 透明传输
- 差错控制

##### 封装成帧
- 封装成帧(framing)就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的界限。
- 首部和尾部的一个重要作用就是进行帧定界。
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_4a96f2cadc9cd8a2c62afc81059e0e4b.png)
- 用控制字符进行帧定界
 - ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_2b70396c7acb639d12367059f9751ce1.png) 

##### 透明传输
- 问题提出
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_605ac266cb3340a713f6b607ad9bc7b8.png)
- 解决方法
  - 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”(其十六进制编码是 1B)。
  - 字节填充(byte stuffing)或字符填充(character stuffing)，即接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。
  - 如果转义字符也出现数据当中，那么应在转义字符前面插入一个转义字符。当接收端收到连续的两个转义字符时，就删除其中前面的一个。
  - ![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_9023b16dafc4b0f7ba9bc9c8ff69ae4a.png)

##### 差错控制
- 如何检测差错？有奇偶检验码、循环冗余码、海明码等
- 要求：加冗余码少，检错率高。
- 分类：
  - 纠错型  
    对数据进行检验并纠正其中错误部分，用于实时控制系统。
  - 检错型  
    对数据进行检验，发现错误要求对方进行重发，用于现在大部分网络系统中。  

## 3.2 以太网基础
### 互联网是由不同类型的传输网络互联而成的网际网
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_17c58ac769ab7e0cac65f67d825bb29d.png)
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_a4a214d264fe03ba02b31fbaf62507c4.png)

### 以太网的发明
- 网络的特征：  
  用一种物理介质，比如电缆，将比特流传输到各个站点
- 古代以太理论：   
  “以太”通过电磁波充满了整个空间

### 以太网的发展过程
1. 传输媒体从采用同轴电缆到双绞线缆和光纤
2. 从共享式以太网发展到交换式以太网
3. 出现VLAN和三层交换技术
4. 从低速以太网发展到高速以太网

#### 传输媒体从采用同轴电缆到双绞线缆和光纤
- 同轴电缆的缺陷：  
  柔软性不够，不容易布线
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_a7647ceb2876d99221915d566ea24549.png)

- 双绞线缆和光纤是两种互补性很强的传输媒体
- 这两种传输媒体的使用催生了一个新兴的行业：综合布线
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_c5786888d9e1236c216187a3c39c86c3.png)

#### 从共享式发展到交换式
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_215d42815b37d5c898e3f2d140cffb2e.png)
- 最初以太网是总线形以太网，也称为共享式以太网
  
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_49b987092c43416a20e35c9292d8e47c.png)

![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_1b969f8fbe36eddacd78e00067a86040.png)
- 交换式以太网是以太网发展过程中的一个**里程碑**

#### 出现VLAN和三层交换技术
- VLAN技术的出现很好地降低了广播所造成的危害
![](https://codimd.s3.shivering-isles.com/demo/uploads/upload_0db1f300ea6b2215bbd55b1156827fed.png)

### 总线型以太网基础
- 总线形以太网是以什么样的结构把终端互联起来的呢？
- 互联的终端要进行通信，网络又需要提供哪些功能呢？
- 这些功能又是划分成哪些模块来实现呢？

#### 本节学习内容
- 总线形以太网拓扑结构
- 总线形以太网功能需求
- 总线形以太网体系结构

#### 拓扑结构


--- 
## 3.3 CSMA/CD算法与以太网标准
### CSMA/CD算法缺陷
- CSMA/CD只适应轻负荷
- CSMA/CD存在捕获效应
- CSMA/CD存在最短帧长与冲突域直径之间的制约

---
#### CSMA/CD只适应轻负荷
- 网络负荷  
  某一时间段内连接在总线上的终端需要通过总线发送的数据总量  
- pic++
- 总线上2个终端同时发送数据，发生冲突
- 2个终端延迟时间不同，终端B发送成功
- pic++
- 总线上5个终端同时发送数据，发生冲突
- 终端A和D的延迟时间相同，结果又发生冲突
- B、C、D三个终端的延迟时间又相同，再次发生冲突
- pic++
- 终端与别的终端冲突中终端处于延迟等待状态
  - ->总线的利用率非常低
    - ->只适应轻负荷

---
#### CSMA/CD算法存在捕获效应
- 什么叫捕获效应？
  - 如果两个终端都想连续发送数据：
    - 一个终端长时间内一直争到总线发送数据
    - 另一个终端长时间内一直争不到总线发送数据
- K是冲突次数， [0，1，…，2**K-1]是一个整数序列，r是从整数序列中随机选择的一个值，t是协议规定的时间，延迟时间T=r×t
- pic++

--- 
#### 冲突域直径与最短帧长之间的制约
- 什么叫冲突域？
- pic++
- pic++
- R是冲突域直径，t是信号在R之间的传输时间
无中继器情况下，t和R之间的关系:
  - **R=t×(2/3)C** (C为光速，C=3×10**8m/s)
- pic++

### 以太网标准
- pic++



--- 
## 3.4 以太网互连与网桥
### 学习目标
1. 熟悉以太网互连的方法 
2. 熟悉广播域与冲突域的概念； 
3. 熟悉网桥的工作原理及冲突域分割。

### 基于HUB的以太网互连
- 冲突域与广播域概念
- 基于集线器的以太网扩展

#### 集线器与以太网互连
- 两个相关概念：
  - **碰撞域（冲突域）**：域内的不同设备同时发出的以太网帧会互相冲突。此时各设备在同一个总线上。
  - **广播域**：域内的设备中的一个发出一个广播时，所有其他的设备都能接收到这个广播帧
  - 三个独立的冲突域.jpg
  - pic++
  - pic++
  - 冲突域越大，发生碰撞的可能性越大，有效通信带宽降低。
- 用集线器扩展局域网（物理层扩展）
  - 优点
    - 使原来属于不同冲突域的局域网上的计算机能够进行跨冲突域的通信。  
    - 扩大了局域网覆盖的地理范围。
  - 缺点
    - 冲突域增大了，但总的吞吐量并未提高。 
    - 如果不同的冲突域使用不同的数据率，那么就不能用集线器将它们互连起来。 **（同构扩展）**

---
### 冲突域分割与网桥
- 网桥分割冲突域原理
- 转发表和MAC帧转发过程
- 网桥工作流程

---
#### 网桥分割冲突域原理
- CSMA/CD算法
  - 轻负荷
  - 捕获效应
  - L与t之间制约
- 解决思路
  - 减少终端
  - 缩小冲突域直径
- 把大的以太网分割为若干个小的冲突域，让每个冲突域里的终端数量减少，距离缩短。然后用一个设备把这些冲突域连接起来，这就是**分割冲突域的基本原理**。
- pic++
- pic++
- 网桥如何判别MAC帧的源和目的终端是否位于网桥不同端口连接的冲突域中？

---
#### 转发表和MAC帧转发过程
- pic++
- pic++
- pic++

---
#### 网桥工作流程
- pic+++

---
## 3.5 交换式以太网与VLAN
### 学习目标
1. 熟悉交换机的工作原理及广播域分割。 
2. VLAN概念 
3. 单交换与跨交换VLAN

---
### 交换机与交换式局域网
#### 交换式局域网
- 传统的共享介质局域网中，存在冲突，且结点数越大越严重。如何解决方法？
  - 网桥的出现，提供了一种解决方案，然而会影响传输效率（转发）
  - 1990 年问世的交换式集线器(switching hub)，可明显地提高局域网的性能。
  - 交换式集线器常称为以太网交换机(switch)或第二层交换机。
  - 以太网交换机通常都有十几个接口。因此，以太网交换机实质上就是一个多接口的网桥，可见交换机工作在数据链路层。 
- 交换机是如何工作？
- pic++
- pic++
- 类似与电路交换，那么冲突域和广播域将如何变化？
  - 软连接->转发表 
- 交换机工作原理
  - 根据收到数据帧中的源MAC地址建立该地址同交换机端口的映射，并将其写入转发表中； 
  - 将数据帧中的目的MAC地址同已建立的MAC地址表进行比较，以决定由哪个端口进行转发； 
  - 如数据帧中的目的MAC地址不在转发表中，则向所有端口转发。
    - 这一过程称为泛洪（flood）； 
  - 广播帧和组播帧向所有的端口转发；
  - 交换机内部的转发表只有300S的存在时间，定时五分钟会更新一次。

- 交换机转发方式
  - 直通转发（cut-through switching ） 
  - 存储转发（Store-and-Forward switching） 
  - 无碎片转发（Fragment-free switching）  
  - > 不同的转发效率

- 以太网交换机的特点
  - 以太网交换机的每个接口都直接与主机相连，并且一般都工作在全双工方式。
  - 交换机能同时连通许多对的接口，使每一对相互通信的主机都能像独占通信媒体那样，进行无碰撞地传输数据。
  - 以太网交换机由于使用了专用的交换结构芯片和优化的转发算法，其交换速率就较高。 
  - 独占传输媒体的带宽
    - 对于普通 10 Mb/s 的共享式以太网，若共有 N 个用户，则每个用户占有的平均带宽只有总带宽(10 Mb/s)的 N 分之一。 
    - 使用以太网交换机时，虽然在每个接口到主机的带宽还是 10 Mb/s，但由于一个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽，因此对于拥有 N 对接口的交换机的总容量为 N X 10 Mb/s。这正是交换机的最大优点。

- 用以太网交换机扩展局域网
- pic++

---
### 广播域分割与VLAN
#### 网桥与广播域
- 网桥以广播方式输出MAC帧时，MAC帧遍历的网络范围，因此是一个广播域。
- pic++
- pic++

---
#### 广播存在哪些危害
- 网桥建立完整转发表之前，广播
- 大量网络协议都是广播协议，广播
- pic++
- 浪费网络链路带宽和网桥、终端的处理能力
- 引发安全问题
- pic++

---
#### 引入VLAN的原因
- 广播不可避免，存在危害->缩小广播域->减少资源浪费,避免引发安全问题

- 广播域划分特性
  - 物理位置无关性
  - 动态性

---
#### 什么是VLAN
- 划分物理以太网产生的每一个广播域等同于一个逻辑上独立的以太网，由于这些逻辑上独立的以太网存在于同一个物理以太网中，因而被称为**虚拟局域网（Virtual LAN，VLAN）**

- VLAN特性
  - 划分VLAN时无需改变已有以太网的物理结构
  - 可以在不改变以太网物理结构的前提下，改变VLAN的数量及属于每一个VLAN的终端。
  - 属于每一个VLAN的终端与该终端在物理以太网中的位置无关

---
#### VLAN的划分过程
- pic++
- 确定属于每一个VLAN的交换机端口
- 在属于相同VLAN的端口之间生成交换路径  
  
完成VLAN的划分后，交换机能够确定接收到的MAC帧所属的VLAN并在它所属的VLAN内转发

- 以交换机为分组交换设备构建的以太网称为交换式以太网
  - 网桥  
    具有地址学习、MAC帧转发等分组交换功能的设备
  - 以太网交换机  
    增加了VLAN划分及其他一些增强网络性能的功能的设备
  - pic++

---
#### 单交换机VLAN划分过程
- pic++


---
### 单交换机VLAN划分
- pic++

---
#### 网络拓扑图

---
### 跨交换机VLAN划分
#### 端口配置原则
-  跨交换机VLAN划分
   -  将物理以太网中不同交换机中的任意端口组合分配到某个VLAN中
   -  建立这些交换机端口之间的交换路径
- 端口配置原则
  - 允许将属于不同交换机的多个端口分配到同一个VLAN
  - 必须保证任何两个属于同一VLAN的端口之间存在交换路径
- pic++
- 把交换机1的端口A和交换机2的端口B划分在同一个VLAN中
- 建立交换机1端口A与交换机2端口B之间的交换路径
  - 交换机1端口C与端口A划分在同一个VLAN
  - 交换机2端口D与端口B划分在同一个VLAN
  - 把交换机1的端口C与交换机2的端口D相连
- pic++

- 存在问题：
  - 一是交换机端口浪费  
    每个跨交换机的VLAN都要有两个端口用来建立交换机之间的交换路径；
  - 二是交换机之间的物理链路数量是不确定的  
    随着跨交换机VLAN数量的变化而变化。

- pic++
- 当终端A向终端D发送MAC帧时，交换机2通过端口1接 收该MAC帧， 由于交换机2端口1是共享端口，交换机2无法根据接收该MAC帧的端口确定该MAC帧所属的VLAN。
- pic++

---
#### VLAN内MAC帧传输过程
- pic++

---

**3.5未完结**

---
## 3.6 无线数据传输与无线局域网
### 本讲学习内容
- 无线局域网是一种利用电磁波在自由空间的传播实现终端之间通信的网络
  - pic++
  - pic++

---
### 学习目标
- 1.了解无线传输的基本特征
- 2.熟悉无线局域网的体系结构
- 3.了解无线局域网的工作原理和典型组网方法

---
### 无线数据传输
- 无线传输过程
- 无线信道的选取
- 电磁波特点

---
#### 无线传输过程
- 1、电磁波传播过程：  
    由变化的电场激发变化的磁场，再由变化的磁场激发新的变化的电场，这种由近及远，不断继续下去的激发过程。
  - pic++
- 2.二进制位流转换成电磁波过程
  - pic++
- 3、无线信道
  - pic++
  - 自由空间传播电磁波需要占据一段频段，这段频段就是**无线信道**
    - 什么样的频段适合数据传输呢？
  - 数据传输速率和电磁波的**波特率成正比**，电磁波的波特率和电磁波带宽成正比 
  - 要想得到较高数据传输速率，电磁波必须有较高的带宽。

---
#### 无线信道的选取：电磁波频谱
- pic++
- 带宽决定传输速率
- 高频段电磁波有高带宽
- 紫外线以上的有伤害性
- 可见光有直线传播特性
- **微波段电磁波进行数据传输**

---
#### 无线信道的选取：ISM频段
- 电磁波在网络通信中得到应用
- 在工业、科学和医疗（Industrial, Scientific, and Medical，简称ISM）等领域也得到广泛应用
- 电磁波频率和发射功率严格控制，每个国家都有权威机构负责，比如我们国家的无线电管理委员会。
- 开放一些电磁波频段让公众自由使用
- 各国尽量将开放的电磁波频段一致，促使相关设备标准化
- pic++

---
#### 电磁波特点
- 1.能量损耗，能量损耗与传播距离平方成正比
- 2.干扰，尤其是ISM频段
  - pic++
- 3、多径效应
  - pic++
- 4、隐蔽站问题 
  - pic++
  - 一个终端检测不到另一个终端发射的电磁波的能量，两个终端对于对方都是不可见的，即是隐蔽的，比如终端A和终端C。
  - 两个终端是相互隐蔽的，同时向另一个终端发送电磁波导致冲突发生的问题：**隐蔽站问题 **，比如终端A和终端C同时向终端B发送数据发生冲突
- 5、暴露站问题
  - pic++
  - 终端B和终端D是相互隐藏的，终端C和终端A是相互隐藏的
  - 终端B向终端A发送电磁波的同时，终端C可以同时向终端D发送电磁波
  - 但由于终端B和终端C不是相互隐藏的，不会同时进行终端B向终端A、终端C向终端D发送电磁波过程：**暴露站问题**  

综合以上这些特点，与有线通信的主要不同
- 1、传输速率
  - 终端位于不同位置时，接收到的信号的强度和信噪比都会不同
  - **香农定理**：数据传输速率取决于电磁波的带宽及信号的信噪比
  - > 位于无线局域网中不同位置的终端，其传输速率可能不同
- 2、信号再生
  - 有线信号可以再生
    - 接收端接收到的信号质量和接收端与发送端之间的距离**无关**
  - 无线信号无法再生
    - 接收端接收到的信号质量和接收端与发送端之间的距离**有关**

---
### 无线局域网体系结构
- 无线局域网分层结构
- 无线局域网协议标准
- pic++
- 逻辑链路控制（LLC）子层：指定数据类型
- MAC子层：MAC地址、MAC帧封装、争用无线信道
- 物理层：无线信道二进制位流传输功能
- pic++
- DIX（ Dec、 Intel和Xerox ）定义的以太网标准中MAC帧有数据类型
- IEEE（电子和电气工程师协会）定义的局域网标准的MAC帧无数据类型
- 以太网采用DIX定义的标准，无需LLC子层
- 无线局域网是IEEE定义的标准，需要LLC子层给出数据类型
- pic++

---
#### 无线局域网标准
- pic++
- 不同的只是物理层，MAC层相同
- 物理层标准的主要区别
  - 电磁波频段
  - 所使用的扩频技术
  - 信号调制技术  

802.11，802.11b， 802.11g和802.11n是兼容的，统称为802.11bgn

- 1．不同标准的频段
  - pic++

- 2．扩频技术
  - $RS=BW×㏒2（1+S/N）$
    - RS最大传输速率
    - BW信道带宽
    - S/N信号信噪比
  - 可以通过提高带宽，或者信号的信噪比来提高信道的数据传输速率
  - 在数据传输速率不变的情况下，可以通过提高信道带宽来降低信号的信噪比
  - 为了提高无线通信的容错性使得无线信道带宽大于实现数据传输速率所要求的带宽的技术称为**扩频技术**

- 3．无线信道
  - pic++ 
  - 一个信道是一段电磁波频段，每个信道的带宽为22MHz
  - 相邻信道频段存在重叠
  - 信道1、信道6、信道11两两之间不存在频率重叠

---
#### 小结
- 1. 无线局域网主要功能由物理层和MAC层完成，LLC层只给出MAC帧的数据类型
- 2. 不同的无线局域网标准主要是物理层不同
- 3. 随着无线局域网的广泛应用，数据传输速率越来越高

---
### 无线局域网组网方式
- 独立基本服务集（IBSS）
- 基本服务集（BSS）
- AP-repeater模式
- 扩展服务集（ESS）
- 无线分布式系统（WDS）
- 无线家庭网络
- 无线局域网与移动互联网

---
#### 独立基本服务集（IBSS）
无线局域网的最小构成单位是基本服务集
- 基本服务集中只包含工作站的称为独立基本服务集（IBSS）
- 基本服务集中包含工作站和AP的称为基本服务集(BSS)
  - pic++ 
- 基本服务集所覆盖的地理范围称为**基本服务区**（BSA）

- 1．网络结构
  - pic++
  - 传输距离短，最大传输距离100~300米
  - IBSS是一个冲突域，终端数量不能太多
  - 实际的IBSS是由一台终端创建，其他终端加入形成的
- 2． MAC帧传输过程
  - pic++
  - 每个终端有一个全球唯一的MAC地址
  - 源终端向目的终端发送数据
  - 目的终端正确接收到数据后发送应答帧    

无线局域网需要接收终端发送确认应答的原因：
- 一是无线通信的可靠性较低，MAC帧传输过程中容易出错。
- 二是隐藏站问题使得发送终端无法检测出所有冲突，任何终端都有可能与其他终端同时发送数据，且检测不到已经发生的冲突

---
#### 基本服务集（BSS）
- 1．网络结构
  - BSS中存在称为接入点（AP）的设备
  - BSS通过AP可以和其他网络实现互连
  - pic++

- 2． MAC帧传输过程
  - 源和目的终端可能不在同一个BSS里
  - 源终端无法确认和目的终端是否在同一个BSS里
  - 由AP来判断源和目的终端是否在同一个BSS
  - 同一BSS中终端之间通信经过AP转发
  - 传输过程中逐段确认
  - pic++

---
#### AP-repeater模式
- 1．网络结构
  - pic++
  - BSS1和BSS2共享同一个信道，任何两个设备通信前必须先争用信道
- 2．MAC帧传输过程
  - pic++
  - 三段传输过程：终端A至AP1、AP1至AP2和AP2至终端C
  - 每一段传输过程，发送端都要争用同一无线信道
  - 传输过程中逐段应答

---
#### 扩展服务集（ESS）
- 1．网络结构
  - pic++
  - pic++
  - 相同的MAC地址
  - 相似的MAC帧格式
  - AP的网桥特性
  - pic++
  - 无线局域网相当于一个网段
  - AP实现MAC帧在以太网和无线局域网之间的转发
  - AP实现以太网MAC帧格式和无线局域网MAC帧格式相互转换过程
- 2．MAC帧传输过程
  - BSS中需要确认应答
  - MAC帧格式转换
  - 以太网中不需要确认应答
  - pic++
  - pic++

---
#### 无线分布式系统（WDS）
- 1．应用需求
  - pic++

---
### DCF和CSMA/CA
- 分布协调功能（DCF）
- CSMA/CA算法操作过程
- RTS和CTS解决隐蔽站问题过程

---
#### 分布协调功能（DCF）
- 建立终端自由平等竞争无线信道机制
  - 载波侦听多点接入/冲突避免（CSMA/CA）机制  
    （Carrier Sense Multiple Access/ Collision Avoidance ）
  - > 总线形以太网 
    > - 载波侦听多点接入/冲突检测（CSMA/CD）机制  
    > Carrie Sense Multiple Access / Collision Detection）
    - 解决隐蔽站问题  
        RTS和CTS

---
#### CSMA/CA操作过程：信道空闲条件
- 信 道  
  IBSS和BSS中所有终端共享同一信道
- 信道忙  
  信道存在电磁波且电磁波能量超过设定阈值
- 信道空闲的先决条件

---
#### CSMA/CA操作过程：帧间间隔
- 1、帧间间隔的作用
  - 帧对界
  - 接收端清空缓存
  - 天线发送状态和接收状态之间切换
- 2、帧间间隔长度
  - 帧间间隔长度
    - 帧间间隔是终端在完成当前MAC帧发送后，进行下一个MAC帧发送前必须等待的一段时间
      - 这段时间的长短取决于终端将要发送的MAC帧的类型
      - 有控制、管理和数据三种类型
  - 帧间间隔长度决定MAC帧的发送优先级
    - 帧间间隔越短，对应类型的MAC帧的发送优先级越高。
  - 帧间间隔类型不同时间长度不同
    - 无线局域网为了对不同类型的MAC帧分配不同的优先级，确定了4种不同的帧间间隔。
- 3、帧间间隔的类型
  - 短帧间间隔（Short InterFrame Space，SIFS）
    - 是无线局域网要求的最短帧间间隔，这段时间用于让终端完成发送方式和接收方式之间的转换。
    - 这种帧间间隔所对应的MAC帧通常是已经取得信道控制权的终端将要发送的MAC帧。
  - 分布协调功能帧间间隔（DCF InterFrame Space， DIFS）
    - 其时间长度＝SIFS+2个时隙。
    - 当终端用DCF方式传输数据时，必须侦听到信道持续空闲DIFS后，才能传输数据或进入**退避时间**。
- 终端发送第一帧检测信道的两种结果：
  - 信道空闲：多个终端同时传发送数据概率低
  - 信道不空闲：多个终端同时发送数据概率高
- 发送端没有冲突检测能力，怎么办？ -> 退避机制
  
---
#### CSMA/CA操作过程：退避算法
- 退避时间
  - 终端在初始检测到信道忙的情况下，每个终端需要通过**退避算法**独立产生随机的延迟时间
  - 退避机制
    - 信道持续空闲DIFS后，只有在退避时间内一直检测到信道空闲的终端才能发送数据的机制
- 设变量CW，称为争用窗口
- 为终端设置最大和最小争用窗口（CWMIN和CWMAX），初始时CW=CWMIN
- 终端检测到信道忙时，在0～CW中随机选择整数R，并使退避时间T=R×ST（ST是固定时隙，取决于无线局域网的物理层协议标准和数据传输速率）
- 发送端在发送MAC帧后，直到重传定时器溢出，都没有接收到确认应答，就认定冲突发生，发送端将通过CSMA/CA算法重新发送该MAC帧，但在计算退避时间时，增大CW值
- 如果i是重传次数，则$CW=2^{3+i}－1$，直到$CW=CW_{MAX}$
- 一旦发送端接收到确认应答，则将CW设置成初值$CW_{MIN}$
- 802.11标准中，$CW_{MIN}＝7，CW_{MAX}＝255$
- 3.6未完结

---
## 3.7 无线局域网设计
### 终端接入无线局域网
- BSS配置过程
- 终端与AP同步过程
- AP鉴别终端过程
- 终端与AP建立关联过程

---
#### BSS配置过程
- 终端接入无线局域网需要接入控制原因
  - 没有物理连接
  - 没有物理边界
- 接入控制过程完成的功能
  - 统一信道
  - 身份鉴别 
- pic

---
- 每一个基本服务集有着唯一的标识符，称作基本服务集标识符（Basic Service Set Identifier，**BSSID**）
  - 一般是AP的MAC地址
- 多个基本服务集可以构成一个扩展服务集，这些基本服务集有着相同的**服务集标识符**（ Service Set Identifier，**SSID**）
- pic

---
- BSSID：属于同一BSS的两个结点之间的通信，MAC帧中必须携带BSSID
- SSID：终端接入无线局域网时必须配置与无线局域网相同的SSID
- pic

---
- pic
- 同一BSS需要确定三组参数
  - 服务集标识符（SSID）
  - 使用的信道
  - 如果采用共享密钥鉴别机制， 还需配置密钥
- AP需要配置三组参数：
  - 用于和终端通信的信道，AP可以自动选择信道
  - 标识AP所在BSS的SSID密钥
  - 用于鉴别接入终端的密钥K
- 配置某个授权终端：
  - 配置SSID
  - 密钥（如果需要的话）
  - 信道通过同步过程确定

---
#### 终端与AP同步过程
- pic
- 同步过程的任务：
  - 搜索AP使用的信道
  - 检测AP和终端配置的SSID是否相同
  - 检测AP和终端支持的物理层标准和传输速率是否存在交集
- pic

---
- 每个AP周期性地按固定间隔时间发送信标帧
- 终端逐个信道侦听信标帧，13个信道逐一侦听就可发现附近的所有AP
- 如果AP允许广播SSID，信标帧携带SSID，终端就会显示出所有这些SSID
- 每个AP固定间隔时间发送信标帧
- 终端逐个信道侦听信标帧，13个信道逐一侦听就可发现附近的所有AP
- 如果AP允许广播SSID，信标帧携带SSID，终端就会显示出所有这些SSID

---
- pics
---

- 终端逐个信道探测：
  - 终端发送探测请求，如果AP接收到该探测请求，立即发送探测响应
  - 13个信道探测一遍，就可发现附近的所有AP
  - 终端获APMAC地址、信道、物理层标准及双方均支持的数据传输速率

---
#### AP鉴别终端过程
鉴别过程是AP判别终端是否是授权终端的过程
- 1、安全强度
  - 802.11支持单向鉴别，即由AP对终端进行鉴别
  - 802.11i支持双向鉴别，即终端和AP互相确认对方
- 2.802.11鉴别方式
  - 开放系统鉴别
  - 共享密钥鉴别
- 开放系统鉴别：
  - 终端向AP发送鉴别请求帧
  - AP并没有进行任何鉴别操作就向终端回送鉴别响应
  - 帧开放系统鉴别方式，所有终端都能得到AP确认

---
- pic
---

- 共享密钥鉴别原理： AP确定终端是否具有共享密钥K的过程
  - P表示没有加密的明文
  - Y表示对明文加密后的密文$Y=E_K(P)$
    - (E表示加密算法，K表示密钥)
  - AP对密文进行解密
    - 如果$D_K(Y)=P$，鉴别成功（D表示解密算法）
  
---
#### 终端与AP建立关联过程
---
- pic
---
- **允许建立关联的前提**：
  - 完成同步过程和鉴别过程，AP具有终端接入需要的资源，比如关联表容量、允许建立关联的终端数量等
- **建立关联后，AP将终端的MAC地址加入到MAC地址列表中**
- 只有将地址加入MAC地址列表中的终端才能通过AP转发MAC帧


---
### 无线局域网设计
- 终端和AP的配置过程
- MAC帧传输过程
- 终端漫游过程
- AP+AC无线局域网结构

---
#### 终端和AP的配置过程
---
- pic
---
- AP有着双重功能：
  - 控制无线终端接入BSS
  - 实现BSS和以太网互连
- 三个BSS有着相同的SSID，以太网互连的三个BSS构成一个广播域
- 每一个AP需要配置：
  - SSID和密钥K
  - 选择自动配置信道方式
    - 侦听附近其他AP信道
    - 选择一个没有重叠的信道
- 每一个终端需要配置
  - SSID和密钥K
- 每一个终端需要完成：
  - 与AP同步过程
  - AP的鉴别过程
  - 与AP建立关联过程

---
- pic
---

- **终端A至终端C MAC帧传输过程**： 
  - 1、终端A至AP1 MAC帧传输过程
  - 2、以太网广播MAC帧过程
  - 3、AP2至终端C MAC帧传输过程

---
#### MAC帧传输过程
- （1）终端A至AP1 MAC帧传输过程
  - 地址1字段是AP1的MAC地址
  - 地址2是源终端A地址
  - 地址3是目的终端B地址

---
- pic
---

- 3.7未完结


---
# 第4章 网络层
## 4.1 网络互联机制
### 学习内容
- 什么是网络互连？
- 信件投递过程的启示
- 端到端传输思路
- 网际协议IP
- IP实现网络互连机制

---
### 什么是网络互连
---
- pic
---

---
### 互连网络与虚拟互连网络
---
- pic
---

---
## 4.2 IP-分类地址
### 学习内容
- IP地址分类方法
- IP地址分类分层的原因
- IP地址配置原则
- IP地址分类的缺陷

---
### IP地址分类方法
---
- pic++
---
> $(192)_d = (11000000)_b$
---
- pic
---
- A类地址中：
  - 0.0.0.0表示IP地址无法确定，终端没有分配IP地址前，可以作为IP分组的**源地址**。
  - 127.x.x.x是回送**测试地址**。127.0.0.1 //ping 127.0.0.1
- 著名组播地址：
  - 224.0.0.1 ：表示网络中所有支持组播的终端和路由器。
  - 224.0.0.2 ：表示网络中所有支持组播的路由器。
  - 224.0.0.9 ： 表示网络中所有运行RIP进程的路由器。

---
### IP地址分类分层的原因
---
- pic++
---
- 网络地址减少路由项的原因：
  - 一是网络地址表示一组终端的IP地址
    - 比如192.1.1.0这个网络地址表示192.1.1.0~192.1.1.255
  - 二是通往这一组终端的下一跳路由器相同


---
### IP地址配置原则
---
- pic
--- 
- 每一个传输网络都有一个网络地址
- 连接在同一传输网络上的终端必须配置具有相同网络号、不同主机号的IP地址
- 路由器的每一个接口都需配置IP地址，该IP地址对应的网络地址必须和分配给该接口连接的传输网络的网络地址相同
- IP地址不是终端或路由器的标识符，而是终端或路由器接口的标识符
- 接口是指终端或路由器与网络之间的连结点，终端或路由器允许有多个接口
- 每一个接口都有独立的标识符——IP地址
---
- pic
---
- 在同一个局域网上的主机或路由器的IP 地址中的**网络号**必须是一样的
---
- pic++
---
- 路由器总是具有两个或两个以上的 IP 地址。
  - 路由器的每一个接口都有一个不同网络号的IP地址。
---
- pic
---
- 两个路由器直接相连的接口处，可指明也可不指明 IP 地址。
  - 如指明 IP 地址，则这一段连线就构成了一种只包含一段线路的特殊“网络”。
  - 现在常不指明 IP 地址


---
### IP地址分类的缺陷
- 1．IP地址浪费严重
  - 假设为一个连接4000个终端的以太网分配IP地址
    - 由于：$2^8－2＜终端数量≤2^{16}－2$ 
      - 所以用**B类地址**
    - B类地址，共有$216－2$个有效IP地址，但只用了4000个
    - 超过90%的有效IP地址被浪费了
- 2．不能更有效地减少路由项
  - pic++
  - 这一组IP地址的低9位从全0到全1，512个IP地址是连续的
  - 对于路由器R2来说，这两个网络可以用一项路由项
  - 但是没有主机号为9位的IP地址类型
- 3．C类地址使用率低
  - pic
  - C类IP地址中网络号的位数是21位，使得C类网络地址数量最多
  - 大部分网络所连接的终端数大于28－2个
  - 真正申请C类地址的单位很少


---
### 小结
- IP地址是分层的，分为网络号和主机号
- IP地址分为A、B、C、D、E五类
- A、B、C三类称为单播地址，网络号和主机号的位数不同
- 固定主机号和网络号位数带来一系列的问题


---
## 4.3 地址解析
### 学习内容
- IP地址与硬件地址的关系
- 地址解析协议 ARP
- 逆地址解析协议 RARP

---
### IP 地址与硬件地址
- 如何处理IP地址与硬件地址的关系？
  - pic++
- IP地址和硬件地址之间如何实现转换？
  - pic++

---
### 地址解析协议 ARP
- 不管网络层使用的是什么协议，在实际网络的链路上传送数据帧时，最终还是必须使用**硬件地址**

- IP->MAC 的转换过程如何？  
  - pic++

- 存在问题
  - 传送效率低
- 解决办法

---
#### ARP 高速缓存的作用
- 为了减少网络上的通信量，主机 A 在发送其 ARP 请求分组时，就将自己的 IP 地址到硬件地址的映射写入 ARP 请求分组。
- 当主机 B 收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了。
- 也就是说：每一个主机都设有一个 ARP 高速缓存(ARP cache)，里面有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。
- 当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。
  - 如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，然后通过局域网将该 MAC 帧发往此硬件地址。

---
#### ARP 高速缓存存在过期情况吗？
- 定期更新，设定时器

---
#### 不在同一局域网时如何处理？
- 通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。
- 从IP地址到硬件地址的解析是自动进行的，主机的用户对这种地址解析过程是不知道的。
- 只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器进行通信，ARP 协议就会自动地将该 IP 地址解析为链路层所需要的硬件地址。

---
#### 使用 ARP 的四种典型情况
- 发送方是主机，要把IP数据报发送到本网络上的另一个主机。这时用ARP 找到目的主机的硬件地址。
- 发送方是主机，要把 IP 数据报发送到另一个网络上的一个主机。这时用 ARP 找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成。
- 发送方是路由器，要把 IP 数据报转发到本网络上的一个主机。这时用 ARP 找到目的主机的硬件地址。
- 发送方是路由器，要把 IP 数据报转发到另一个网络上的一个主机。这时用 ARP 找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成。

---
### 逆地址解析协议 RARP
- 逆地址解析协议 RARP 使只知道自己硬件地址的主机能够知道其 IP 地址。
- 这种主机往往是无盘工作站。 因此 RARP协议目前已很少使用。
  - pic


---
## 4.4 IP数据报
### 学习内容
- IP分组首部格式
- 数据分片方法
- IP分组传递过程

---
### IP分组首部格式
---
- pic++
---

---
## 4.6 IPv6
### IPv4协议的局限性
- IP地址空间耗尽问题 
- NAT虽然可以缓解部分问题，但对网络性能、安全和应用产生了很大影响 ；
- 人们对更简便配置IP地址的需求越来越迫切； 
- 人们对IP级安全性的需求越来越高； 
- 对网络层实时数据传送服务质量QoS提出了更高的要求

---
### IPv6 的主要特征
- 新的协议首部格式，可以最大限度地减少协议首部处理开销； 
- 巨大的地址空间
  - $2^{128}$
  - 地球表面每平方米可获得 $6.65*10^{23}$ 个; 
- 有效的分级路由结构； 
- 支持地址自动分配； 
- 内置的安全性； 
- 更好地支持QoS； 
- 协议更加简洁； 
- 可扩展性。

---
### 4.6.1 IPv6地址基本首部
- IPv6 将首部长度变为固定的 40 字节
  - 称为基本首部(base header)。
- 将不必要的功能取消了，首部的字段数减少到只有 8 个。 
- 取消了首部的检验和字段
  - 加快了路由器处理数据报的速度。 
- 在基本首部的后面允许有零个或多个扩展首部。 
- 所有的扩展首部和数据合起来叫做数据报的有效载荷(payload)或 净负荷。
  
---
### IPv6 数据报的一般形式
![4.6.1 IPv6 数据报的一般形式](https://codimd.s3.shivering-isles.com/demo/uploads/upload_aa2321691850acfbd32ed724fd1a8791.png)
![4.6.1 IPv6 数据报的一般形式2](https://codimd.s3.shivering-isles.com/demo/uploads/upload_c639ede660ee23a48da5ec5251d2f1fa.png)


---
### 4.6.2 IPv6的地址
- IPv6 数据报的目的地址可以是以下三种基本类型地址之一：
  - 单播(unicast) 
    - 单播就是传统的点对点通信。 
  - 多播(multicast) 
    - 多播是一点对多点的通信。 
  - 任播(anycast) 
    - 这是 IPv6 增加的一种类型。
    - 任播的目的站是一组计算机 ，
      - 但数据报在交付时只交付其中的一个，
        - 通常是距离最近的一个

---
### 4.6.3 从IPv4向IPv6过渡

---
### 4.6.4 ICMPv6



---
## 4.7 IP多播

---
### 4.7.1 IP多播的基本概念
![不使用多播时需要 发送 90 次单播](https://codimd.s3.shivering-isles.com/demo/uploads/upload_25d372ba616a27c61e829e20162aa263.png)
![多播可明显地减少 网络中资源的消耗](https://codimd.s3.shivering-isles.com/demo/uploads/upload_d563d5eeecf1498c6c1d05c945c3dfe9.png)

---
#### 如何实现IP多播?
- 多播使用组地址
  - IP 使用 D 类地址支持多播。
    ![IP分类地址](https://codimd.s3.shivering-isles.com/demo/uploads/upload_05423038aff3920f9155445e45a29ce2.png)
  - 多播地址只能用于目的地址，而不能用于源地址
- 动态的组成员的管理 ——IGMP
- 使用硬件进行多播
- 多播路由

---
- 组地址
  - 在局域网上进行硬件多播
  - 因特网号码指派管理局 IANA 拥有的以太网地址块的高 24 位为 00-00-5E。
  - 因此 TCP/IP 协议使用的以太网多播地址块的范围是：
    - 从 **00-00-5E-00-00-00** 到 **00-00-5E-FF-FF-FF**
  - D 类 IP 地址可供分配的有 28 位，
    - 在这 28 位中的前 5 位不能用来 构成以太网硬件地址。
  - D 类 IP 地址与以太网多播地址的映射关系
    ![D 类 IP 地址与以太网多播地址的映射关系](https://codimd.s3.shivering-isles.com/demo/uploads/upload_58c7af2f32a11b0e395afefe246a5d04.png)

---
- 多播协议
  - IP多播需要两种协议
    - 为了使路由器知道多播组成员的信息，需要利用
      - 网际组管理协议
        - IGMP (Internet Group Management Protocol)
  - 连接在局域网上的多播路由器还必须和因特网上的其他多播路由 器协同工作
    - 以便把多播数据报用最小代价传送给所有的组成员 。
    - 这就需要使用多播路由选择协议


---
### 4.7.2 在局域网上进行硬件多播

---
### 4.7.3 网际组管理协议 IGMP 和多播路由选择协议

---
#### 网际组管理协议 IGMP
---
- 如何管理组成员？
  - IGMP 并非在因特网范围内对所有多播组成员进行管理的协议。
  - IGMP 不知道 IP 多播组包含的成员数，也不知道这些成员都分 布在哪些网络上。
  - IGMP 协议是让连接在本地局域网上的多播路由器知道本局域网 上是否有主机（严格讲，是主机上的某个进程）参加或退出了某 个多播组
    ![4.7.3IGMP](https://codimd.s3.shivering-isles.com/demo/uploads/upload_7f7d767ca4e2e4b1fda8fc7f83c91f35.png) 
  
  - 和 ICMP 相似，IGMP 使用 IP 数据报传递其报文
    - 即 IGMP 报文 加上 IP 首部构成 IP 数据报
    - 但它也向 IP 提供服务。
  - 不要把 IGMP 看成是一个单独的协议，而是属于整个网际协议 IP 的一个组成部分。

---
- 加入多播组
  - 主机和路由器都可以加入一个多播组。
    - 当某个主机中的一个进程申请加入 一个多播组时，
      - 主机将发送一个成员关系报告报文到它所在的IP子网的多播 路由器上；
      - 路由器接收到该申请后将检查它的群组成员关系表，看该主机 是否已经在群组中。
        - 如果该主机不在群组关系表中
          - 即第一次申请
          - 随 即将自己的IP模块做相应的准备，
          - 以便开始接收来自该多播组传来的数据。 
        - 如果这台主机是它所在的IP子网中第一台加入该多播组的主机，
          - 则多播路由 器将通过路由信息的交换加入多播分布树。

---
- 退出多播组
  - 当主机发现在一个特定的多播组中已经没有进程时
    - 就发送退出报告。
      - 多 播路由器收到退出报告后，并不立即删除这个群组，
        - 而是针对该群组发送 查询报文。
        - 当在指定的时间内没有收到相关主机（和路由器）对该群组的 成员关系报告时，
          - 就意味着在本网络上已经没有该群组成员，
          - 此时，多播 路由器将删除该群组。
        - 否则继续保留该群组。

---
- 查询成员关系
  - 由于多播组中的成员关系是动态变化的，并且有些变化是由于异常事件而 引起的，
    - 例如某个群组的某台成员主机因异常而关机，此时多播路由器将 永远接收不到其退出报告。
  - 为了实时掌握群组的成员组成，IGMP提供了一 种机制来监控其某个网络上的所有主机和路由器，以便确定群组和主机或 路由器之间的关系
  
  ![源点基准 树/有源树](https://codimd.s3.shivering-isles.com/demo/uploads/upload_aa34953dd79cf8f9fe375f1a638fbe04.png) 
  
  ![4.7.2组共享树](https://codimd.s3.shivering-isles.com/demo/uploads/upload_7c76d1fc3fb9a20186644d59c777529e.png)
 

---
#### 多播路由选择协议
- 距离向量多播路由选择协议 DVMRP (Distance Vector Multicast Routing Protocol) 
- 基于核心的转发树 CBT (Core Based Tree) 
- 开放最短通路优先的多播扩展 MOSPF (Multicast Extensions to OSPF) 
- 协议无关多播-稀疏方式 PIM-SM (Protocol Independent Multicast-Sparse Mode) 
- 协议无关多播-密集方式 PIM-DM (Protocol Independent Multicast-Dense Mode)

---
- 多播路由选择协议的实现
  ![4.7.3多播路由选择协议的实现](https://codimd.s3.shivering-isles.com/demo/uploads/upload_72a1812e06b9d6acf5d4915706978093.png) 


---
## 4.8 虚拟专用网 VPN 和网络地址转换 NAT

---
### 4.8.1 虚拟专用网VPN

---
### 4.8.2 网络地址转换NAT

---
#### 问题导入
- 私有地址 
  - 10.0.0.0~10.255.255.255 
  - 172.16.0.0~172.31.255.255 
  - 192.168.0.0~192.168.255.255
- 公网地址 
  - 其余的 A、B、C 类地址为公网地址
    ![4.8.2 如何上网](https://codimd.s3.shivering-isles.com/demo/uploads/upload_3516cd2767cc6640e3217b32400aa7ec.png)

---
#### 网络地址导入NAT
- NAT
  - Network Address Translation
  - 网络地址转换 NAT 方法于1994年提出
  - 需要在专用网连接到因特网的路由器上安装 NAT 软件。
    - 装有 NAT 软件的路由器叫做 NAT路由器，
      - 它至少有一个有效的外部全球地址 $IP_G$。
  - 所有使用本地地址的主机在和外界通信时都要在 NAT 路由器上将 其本地地址转换成 $IP_G$ 才能和因特网连接

- 内部主机 X 用本地地址 IPX 和因特网上主机 Y 通信所发送的数据 报必须经过 NAT 路由器
- NAT 路由器将数据报的源地址 IPX 转换成全球地址 IPG，但目的地 址 IPY 保持不变，然后发送到因特网。 
- NAT 路由器收到主机 Y 发回的数据报时，知道数据报中的源地址 是 IPY 而目的地址是 IPG。 
- 根据 NAT 转换表，NAT 路由器将目的地址 IPG 转换为 IPX，转发 给最终的内部主机 X。
  ![4.8.2 NAT](https://codimd.s3.shivering-isles.com/demo/uploads/upload_eb299aa90c240d34f73d54fcaf1eae9c.png)

---


---
# 第5章 传输层

---
## 5.6 拥塞控制
- 滑动窗口
  - 大小决定于
      - 接收方的接受能力
      - 网络的传输能力
  - 获得反馈依赖
    - 接收方收到小秀之后发送ACK信号，发送方通过ACK信号判断是否传输成功

- ping命令
  - 可以测量连通性
  - 也可以测试网络的传输能力
    - 看看能收到几个接收的数据包
          
---
### 网络发生拥塞的现象及原因
- **拥塞**是指分组交换**设备中**经过某条链路的流量超出链路的传输能力，使得输出队列中等待输出的报文越来越多，以至于发生输出队列溢出，报文丢弃的情况
- 网络会发生拥塞的原因：
  - 拥塞主要和网络流量的分布状态有关
  - 提高转发结点的性能并不能消除拥塞
    - 简单提高结点的缓存容量，由于输出链路的容量和处理剂的速度并未提高，因此会导致大量的重传，反而浪费了网络资源
  - 问题的实质往往是整个系统的各部分不匹配，只有所有的部分都平衡了，问题才能得到解决；
    - 解决拥塞的简单方法是控制发送端流量

- 若何确定网络发生拥塞？
  - 网络传输TCP报文过程中发生丢失报文说明发生拥塞，如何识别丢失？
  - 报文丢失就需要重传，因此重传就需要调整发送端流量
    - 经常出现重传，甚至连续出现重传 -》 拥塞      
          
---
- TCP避免和消除拥塞的机制
  - 控制流量依据是接收端的处理能力和**网络状态**
  - 接收端的处理能力通过确认应答数据报（窗口字段）告知发送端
          
          
---
# 第6章 应用层

---
## 6.1 域名系统DNS
- 入网计算机的标识:IP地址
  - 网络标识|主机标识
  - 特点
    - 唯一性
    - 便于管理
    - 难记忆
- 域名
  - 唯一性
  - 便于管理
  - 易记忆
![](../res/img/计算机网络/6.1.1-入网标识.png)

---
- 网络层和传输层协议都是依据**IP地址**进行**数据传送**
  - 因此，应用层域名标识需要转换成IP地址才能进行数据传送。
    - 如何转换？由谁来转换？
![](../res/img/计算机网络/6.1.1-ip-域名.png)

- 手机号码与人名之间的转换
  - 通讯录
    - 姓名+手机号码关系存储
    - 查表实现转换

![](../res/img/计算机网络/6.1.1-手机通信录与DNS特征比较.png)
- 通信录方式只适合小规模的网络的域名转换，**互联网的域名转换不可能采用**
  - 针对DNS需重新思考
    - 如何存储？
    - 如何实现解析(转换)？

---
### 6.1.1 域名系统概述

---
#### DNS中如何存储所需数据


---
#### 域名服务器种类



---
#### DNS中如何实现域名解析
- 两个步骤
  - （1）**终端向本地域名服务器提出解析请求**
    - 终端配置的**本地域名服务器**是终端解析域名时访问的第一个域名服务器
      - 即**应用程序首先向本地域名服务器提出解析请求**。
        ![](../res/img/计算机网络/6.1.1-Internet属性.png)
  - （2）**本地域名服务器向其他域名服务器提出解析请求**
    - 解析方法
      - 迭代解析
      - 递归解析

---





---
### 6.1.2 互联网的域名结构

---
### 6.1.3 域名服务器


---
## 6.2文件传送协议

---
### 如何利用网络实现文件共享
- 引入客户机服务器模式
  ![](../res/img/计算机网络/6.2-引入客户机服务器模式.png)

### FTP系统结构
![](../res/img/计算机网络/6.2-FTP系统结构.png)
- 客户机和FTP服务器之间如何实现文件检索等操作？
  - 如何实现文件的上传下载？
    - **文件传输协议**

---
### 文件传送协议
- 文件传送协议 FTP (File Transfer Protocol) 是因特网上使用得最广泛的文件传送协议。
- FTP 提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。
- FTP 屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件。
- RFC 959 很早就成为了因特网的正式标准

---
- 网络环境下复制文件的复杂性
  - 计算机存储数据的格式不同。
  - 文件的目录结构和文件命名的规定不同。  
  - 对于相同的文件存取功能，操作系统使用的命令不同。  
  - 访问控制方法不同。  

---
### FTP的实现
![](../res/img/计算机网络/6.2-FTP的实现.png)
- 服务器：
  - 打开熟知端口（端口号为 21），使客户进程能够连接上。
  - 等待客户进程发出连接请求。
  - 启动从属进程来处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程。
  - 回到等待状态，继续接受其他客户进程发来的请求。主进程与从属进程的处理是并发地进行。



---
## 6.3 远程终端协议 TELNET

---
### 如何实现电脑的远程控制
- 什么是电脑的远程控制?
  - 通过一台电脑操作另一台远程电脑就像本地操作一样，也称为远程桌面。
- 如何实现？
  - **远程主机本地化**
    ![](../res/img/计算机网络/6..3.1-远程主机本地化.png)

---
## 6.4 万维网 WWW

---
### 6.4.1 万维网概述

---
#### 什么是WWW服务
- 传统的信息检索方法
  ![](../res/img/计算机网络/6.4-传统的信息检索方法.png)
  - 线性检索，集中存储
---
- 分布式存储，跳跃式检索
  ![](../res/img/计算机网络/6.4.1-分布式存储，跳跃式检索.png) 
  - 更好地满足人的联想式思维方法
---
- 超文本与超媒体
  ![](../res/img/计算机网络/6.4.1-超文本与超媒体.png) 
---
- WWW(World Wide Web)服务
  - 是一种建立在超文本基础上的浏览、查询因特网信息的方式
  - 它以**交互方式查询**并且**访问存放于远程计算机的信息**
  - 为多种因特网浏览与检索访问提供一个单独一致的访问机制。
  - Web 页将**文本**、**超媒体**、**图形**和**声音**结合在一起。给终端用户带来通信与获取信息资源的便利。
---
- WWW以客户服务器方式工作。
  - 浏览器就是在用户计算机上的WWW客户程序。WWW文档所驻留的计算机则运行服务器程序，因此这个计算机也称为**Web服务器**。
  - 客户程序向服务器程序发出请**求**，服务器程序向客户程序送回客户所要的**WWW文档**。
  - 在一个客户程序主窗口上显示出的WWW文档称为页面(page)

---
#### 如何实现WWW服务
- 页面的组织
  - HTML(HyperText Markup Language)，超文本标记语言
- 超链的表示
  - URL (Uniform Resource Locator)，统一资源定位符
- 文档的传送
  - HTTP(HyperText Transfer Protocol)，超文本传输协议




---
### 6.4.2 统一资源定位符 URL

---
### 6.4.3 超文本传送协议 HTTP

---
### 6.4.4 万维网的文档

---
### 6.4.5 万维网的信息检索系统

---
### 6.4.6 博客和微博

---
### 6.4.7 社交网站








